<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üèÜ SAT Vocab Master - Learn 2000+ Words</title>
<meta name="description" content="Master 2000+ SAT vocabulary words with pronunciation, emoji mnemonics, music connections, flashcards, and 456 practice test questions.">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèÜ</text></svg>">
<!-- Google Analytics - Replace G-LCGNFJ3J9R with your Measurement ID -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LCGNFJ3J9R"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-LCGNFJ3J9R');</script>
<style>
:root{
  --p:#6C5CE7;--pl:#A29BFE;--pd:#4834D4;
  --a:#00B894;--a2:#FDCB6E;--d:#E17055;
  --bg:#0F0F1A;--bg2:#1A1A2E;--bg3:#16213E;
  --c:#1E1E32;--ch:#2A2A45;
  --t:#E8E8F0;--td:#8888AA;--b:#333355;--s:#00B894;
  --g1:linear-gradient(135deg,#6C5CE7,#A29BFE);
  --g2:linear-gradient(135deg,#00B894,#55EFC4);
  --g3:linear-gradient(135deg,#E17055,#FDCB6E);
  --sh:0 4px 15px rgba(0,0,0,.3);--r:12px;--rs:8px;
  --music:#E91E63;--music-bg:rgba(233,30,99,.12);
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--t);min-height:100vh;overflow-x:hidden}
a{color:var(--pl);text-decoration:none}
button{cursor:pointer;border:none;font-family:inherit}
input,select{font-family:inherit}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:var(--bg2)}
::-webkit-scrollbar-thumb{background:var(--b);border-radius:3px}

.nav{position:fixed;top:0;left:0;right:0;z-index:100;background:rgba(15,15,26,.95);backdrop-filter:blur(20px);border-bottom:1px solid var(--b);padding:0 20px}
.nav-in{max-width:1400px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;height:60px}
.logo{font-size:1.3em;font-weight:800;background:var(--g1);-webkit-background-clip:text;-webkit-text-fill-color:transparent;display:flex;align-items:center;gap:6px}
.nav-tabs{display:flex;gap:4px}
.nav-tab{padding:7px 16px;border-radius:20px;background:0;color:var(--td);font-size:.88em;font-weight:600;transition:.3s}
.nav-tab:hover{color:var(--t);background:var(--bg3)}
.nav-tab.active{background:var(--p);color:#fff}
.nav-st{display:flex;gap:12px;font-size:.82em;color:var(--td)}
.nav-st strong{color:var(--a)}

.mob-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:rgba(15,15,26,.98);backdrop-filter:blur(20px);border-top:1px solid var(--b);justify-content:space-around;padding:6px 0;z-index:100}
.mob-btn{display:flex;flex-direction:column;align-items:center;gap:1px;color:var(--td);font-size:.65em;padding:4px 8px;background:0}
.mob-btn.active{color:var(--pl)}
.mob-btn span:first-child{font-size:1.8em}
@media(max-width:768px){
  .nav-tabs,.nav-st{display:none!important}
  .mob-nav{display:flex}
  .main{padding-bottom:70px!important}
  .hero h1{font-size:1.6em!important}
  .w-grid{grid-template-columns:1fr!important}
  .tu-grid{grid-template-columns:repeat(auto-fill,minmax(130px,1fr))!important}
}

.main{padding-top:76px;max-width:1400px;margin:0 auto;padding-left:20px;padding-right:20px}
.section{display:none;padding-bottom:50px}.section.active{display:block}
.hero{text-align:center;padding:30px 10px}
.hero h1{font-size:2.4em;margin-bottom:8px;background:var(--g1);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{color:var(--td);font-size:1em;margin-bottom:25px}
.stats-row{display:flex;gap:15px;justify-content:center;flex-wrap:wrap}
.stat-c{background:var(--c);border:1px solid var(--b);border-radius:var(--r);padding:16px 24px;text-align:center;min-width:130px}
.stat-c .n{font-size:1.8em;font-weight:800;background:var(--g2);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.stat-c .l{color:var(--td);font-size:.8em;margin-top:3px}
.search-c{max-width:600px;margin:25px auto;position:relative}
.search-in{width:100%;padding:13px 18px 13px 46px;background:var(--c);border:2px solid var(--b);border-radius:30px;color:var(--t);font-size:1em;outline:0;transition:.3s}
.search-in:focus{border-color:var(--p)}
.search-ic{position:absolute;left:16px;top:50%;transform:translateY(-50%);font-size:1.1em;color:var(--td)}
.search-r{position:absolute;top:100%;left:0;right:0;margin-top:6px;background:var(--c);border:1px solid var(--b);border-radius:var(--r);max-height:380px;overflow-y:auto;z-index:50;display:none}
.search-r.show{display:block}
.sr-item{padding:10px 18px;cursor:pointer;border-bottom:1px solid var(--b);transition:.2s}
.sr-item:hover{background:var(--ch)}.sr-item:last-child{border:0}
.sr-w{font-weight:700;font-size:1em}.sr-d{color:var(--td);font-size:.82em;margin-top:2px}
.qa{display:flex;gap:12px;justify-content:center;margin:25px 0;flex-wrap:wrap}
.qa-btn{padding:12px 26px;border-radius:var(--r);font-size:1em;font-weight:600;transition:.2s}
.qa-btn:hover{transform:translateY(-2px)}
.btn-p{background:var(--g1);color:#fff}.btn-s{background:var(--g2);color:#fff}
.btn-o{background:var(--c);color:var(--t);border:1px solid var(--b)}
.w-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(310px,1fr));gap:14px}
.w-card{background:var(--c);border:1px solid var(--b);border-radius:var(--r);padding:18px;transition:.3s;cursor:pointer;position:relative;overflow:hidden}
.w-card:hover{transform:translateY(-3px);box-shadow:var(--sh);border-color:var(--p)}
.w-head{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}
.w-title{font-size:1.25em;font-weight:700;background:var(--g1);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.w-pron{color:var(--td);font-size:.82em;margin-top:2px}
.w-acts{display:flex;gap:5px}
.w-btn{width:30px;height:30px;border-radius:50%;background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:.85em;transition:.2s;color:var(--td)}
.w-btn:hover{background:var(--p);color:#fff}
.w-btn.fav{background:var(--d);color:#fff}
.w-emoji{font-size:1.8em;margin:6px 0}
.w-def{font-size:.87em;line-height:1.45;margin-bottom:6px}
.w-sent{font-size:.8em;color:var(--td);font-style:italic;background:var(--bg3);padding:7px 10px;border-radius:var(--rs);line-height:1.35;margin-bottom:6px}
.w-sent strong{color:var(--pl);font-style:normal}
.w-music{font-size:.82em;padding:6px 10px;border-radius:var(--rs);background:var(--music-bg);border-left:3px solid var(--music);line-height:1.35;margin-top:6px}
.w-music a{color:var(--music);font-weight:600}
.w-visual{font-size:.82em;padding:8px 10px;border-radius:var(--rs);background:rgba(108,92,231,.12);border-left:3px solid var(--pl);line-height:1.35;margin-top:6px;margin-bottom:6px;color:var(--t)}
.w-visual em{color:var(--pl);font-style:italic}
.w-img-wrap{position:relative;border-radius:var(--rs);overflow:hidden;margin-top:8px;margin-bottom:8px;background:var(--bg3);min-height:80px}
.w-img-wrap img{width:100%;border-radius:var(--rs);display:block;max-height:260px;object-fit:cover}
.w-img-wrap .img-loading{display:flex;align-items:center;justify-content:center;gap:8px;padding:20px;color:var(--td);font-size:.85em}
.w-img-wrap .img-loading .spinner{width:20px;height:20px;border:2px solid var(--b);border-top:2px solid var(--pl);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.gen-img-btn{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;border-radius:20px;background:var(--g1);color:#fff;font-size:.82em;font-weight:600;margin-top:6px;transition:.2s}
.gen-img-btn:hover{transform:translateY(-1px);box-shadow:0 2px 8px rgba(108,92,231,.4)}
.site-footer{text-align:center;padding:30px 20px 20px;margin-top:40px;border-top:1px solid var(--b);color:var(--td);font-size:.82em}
.visitor-counter{display:inline-flex;align-items:center;gap:8px;background:var(--c);border:1px solid var(--b);border-radius:20px;padding:8px 18px;margin-bottom:12px}
.visitor-counter .vc-icon{font-size:1.2em}
.visitor-counter .vc-num{font-weight:700;color:var(--a);font-size:1.1em}
.visitor-counter .vc-label{color:var(--td)}
.w-extra{font-size:.78em;color:var(--td);margin-top:6px;padding-top:6px;border-top:1px solid var(--b)}
.w-tag{position:absolute;top:6px;right:6px;font-size:.65em;padding:2px 7px;border-radius:10px;background:var(--s);color:#fff}
.modal-ov{position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(5px);z-index:200;display:none;align-items:center;justify-content:center;padding:20px}
.modal-ov.show{display:flex}
.modal{background:var(--bg2);border:1px solid var(--b);border-radius:var(--r);max-width:700px;width:100%;max-height:90vh;overflow-y:auto;padding:28px;position:relative}
.modal-x{position:absolute;top:12px;right:12px;width:34px;height:34px;border-radius:50%;background:var(--bg3);color:var(--t);font-size:1.1em;display:flex;align-items:center;justify-content:center}
.modal-x:hover{background:var(--d)}
.fbar{display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap;align-items:center}
.f-sel{padding:7px 12px;border-radius:var(--rs);background:var(--c);color:var(--t);border:1px solid var(--b);font-size:.88em;outline:0}
.f-tag{padding:5px 12px;border-radius:20px;background:var(--bg3);color:var(--td);font-size:.82em;border:1px solid transparent;transition:.2s}
.f-tag:hover,.f-tag.active{border-color:var(--p);color:var(--pl);background:rgba(108,92,231,.12)}
.abar{display:flex;flex-wrap:wrap;gap:3px;margin-bottom:12px;justify-content:center}
.a-btn{width:30px;height:30px;border-radius:5px;background:var(--c);color:var(--td);font-size:.75em;font-weight:700;display:flex;align-items:center;justify-content:center;border:1px solid var(--b);transition:.2s}
.a-btn:hover,.a-btn.active{background:var(--p);color:#fff;border-color:var(--p)}
.mbar{display:flex;gap:6px;margin-bottom:16px;flex-wrap:wrap}
.m-btn{padding:7px 14px;border-radius:20px;font-size:.82em;font-weight:600;background:var(--c);color:var(--td);border:1px solid var(--b);transition:.2s}
.m-btn:hover,.m-btn.active{background:var(--p);color:#fff;border-color:var(--p)}
.pag{display:flex;gap:6px;justify-content:center;margin:25px 0;flex-wrap:wrap}
.pg-btn{padding:6px 12px;border-radius:var(--rs);background:var(--c);color:var(--t);font-size:.85em;border:1px solid var(--b);transition:.2s}
.pg-btn:hover{border-color:var(--p)}.pg-btn.active{background:var(--p);color:#fff;border-color:var(--p)}
.pg-btn:disabled{opacity:.35;cursor:not-allowed}
.fc-wrap{max-width:600px;margin:0 auto;perspective:1000px}
.fc{width:100%;min-height:340px;position:relative;cursor:pointer;transform-style:preserve-3d;transition:transform .6s}
.fc.flip{transform:rotateY(180deg)}
.fc-face{position:absolute;inset:0;backface-visibility:hidden;background:var(--c);border:2px solid var(--b);border-radius:var(--r);padding:35px;display:flex;flex-direction:column;align-items:center;justify-content:center}
.fc-back{transform:rotateY(180deg)}
.fc-nav{display:flex;gap:12px;justify-content:center;margin-top:20px}
.tu-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:10px;margin-bottom:25px}
.tu-card{background:var(--c);border:1px solid var(--b);border-radius:var(--r);padding:18px;text-align:center;transition:.3s;cursor:pointer}
.tu-card:hover{transform:translateY(-2px);border-color:var(--p)}
.tu-num{font-size:1.3em;font-weight:800;color:var(--pl)}.tu-label{color:var(--td);font-size:.8em;margin-top:3px}
.tu-score{font-size:.78em;margin-top:5px}
.t-wrap{max-width:800px;margin:0 auto}
.t-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:8px}
.t-prog{width:100%;height:7px;background:var(--bg3);border-radius:4px;margin-bottom:16px;overflow:hidden}
.t-prog-bar{height:100%;background:var(--g2);border-radius:4px;transition:width .5s}
.q-card{background:var(--c);border:1px solid var(--b);border-radius:var(--r);padding:25px;margin-bottom:16px}
.q-num{font-size:.82em;color:var(--pl);font-weight:600;margin-bottom:10px}
.q-text{font-size:1em;line-height:1.6;margin-bottom:16px}
.q-blank{display:inline-block;min-width:100px;border-bottom:2px solid var(--p);margin:0 3px}
.opts{display:flex;flex-direction:column;gap:8px}
.opt-btn{padding:12px 18px;border-radius:var(--rs);background:var(--bg3);color:var(--t);font-size:.92em;text-align:left;transition:.2s;border:2px solid transparent;display:flex;align-items:center;gap:10px}
.opt-btn:hover{border-color:var(--p);background:rgba(108,92,231,.08)}
.opt-btn.sel{border-color:var(--p);background:rgba(108,92,231,.15)}
.opt-btn.cor{border-color:var(--s);background:rgba(0,184,148,.12);color:var(--s)}
.opt-btn.wrn{border-color:var(--d);background:rgba(225,112,85,.12);color:var(--d)}
.opt-l{width:26px;height:26px;border-radius:50%;background:var(--c);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.82em;flex-shrink:0}
.t-nav{display:flex;gap:10px;justify-content:center;margin-top:16px}
.t-btn{padding:9px 20px;border-radius:var(--rs);font-weight:600;font-size:.9em;transition:.2s}
.q-dots{display:flex;gap:4px;justify-content:center;margin-top:12px;flex-wrap:wrap}
.q-dot{width:26px;height:26px;border-radius:50%;font-size:.7em;display:flex;align-items:center;justify-content:center;color:#fff}
.res-card{background:var(--c);border:1px solid var(--b);border-radius:var(--r);padding:35px;text-align:center}
.res-score{font-size:3.5em;font-weight:800;background:var(--g2);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.res-label{color:var(--td);font-size:1em;margin-bottom:16px}
.res-row{display:flex;gap:18px;justify-content:center;flex-wrap:wrap;margin:16px 0}
.res-item{text-align:center}.res-item .n{font-size:1.3em;font-weight:700}.res-item .l{font-size:.75em;color:var(--td)}
.fav-empty{text-align:center;padding:50px 20px;color:var(--td)}.fav-empty-ic{font-size:3.5em;margin-bottom:12px}
.stitle{font-size:1.4em;font-weight:700;margin-bottom:16px;display:flex;align-items:center;gap:8px}
.toast{position:fixed;bottom:25px;left:50%;transform:translateX(-50%);background:var(--c);border:1px solid var(--b);border-radius:var(--rs);padding:10px 22px;z-index:300;opacity:0;transition:opacity .3s;font-size:.88em}.toast.show{opacity:1}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}.fin{animation:fadeIn .35s ease-out}
.wod{max-width:600px;margin:16px auto}
</style>
</head>
<body>

<nav class="nav"><div class="nav-in">
  <div class="logo">üèÜ SAT Vocab Master</div>
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="go('home')">Home</button>
    <button class="nav-tab" onclick="go('learn')">Learn</button>
    <button class="nav-tab" onclick="go('test')">Test</button>
    <button class="nav-tab" onclick="go('fav')">Favorites</button>
  </div>
  <div class="nav-st"><span>Learned: <strong id="nLearned">0</strong></span><span>Favs: <strong id="nFav">0</strong></span></div>
</div></nav>

<div class="mob-nav">
  <button class="mob-btn active" data-s="home" onclick="go('home')"><span>üè†</span>Home</button>
  <button class="mob-btn" data-s="learn" onclick="go('learn')"><span>üìö</span>Learn</button>
  <button class="mob-btn" data-s="test" onclick="go('test')"><span>‚úçÔ∏è</span>Test</button>
  <button class="mob-btn" data-s="fav" onclick="go('fav')"><span>‚ù§Ô∏è</span>Favs</button>
</div>

<div class="main">

<div id="s-home" class="section active">
  <div class="hero">
    <h1>üèÜ SAT Vocab Master</h1>
    <p>Master 2000+ SAT words with pronunciation, emoji mnemonics, music connections & quizzes</p>
    <div class="stats-row">
      <div class="stat-c"><div class="n" id="stTotal">0</div><div class="l">Total Words</div></div>
      <div class="stat-c"><div class="n">38</div><div class="l">Test Units</div></div>
      <div class="stat-c"><div class="n">456</div><div class="l">Questions</div></div>
      <div class="stat-c"><div class="n" id="stMast">0</div><div class="l">Mastered</div></div>
    </div>
  </div>
  <div class="search-c">
    <span class="search-ic">üîç</span>
    <input class="search-in" id="sInput" placeholder="Search any SAT word..." oninput="doSearch(this.value)" onfocus="doSearch(this.value)">
    <div class="search-r" id="sResults"></div>
  </div>
  <div class="qa">
    <button class="qa-btn btn-p" onclick="go('learn')">üìö Start Learning</button>
    <button class="qa-btn btn-s" onclick="go('test')">‚úçÔ∏è Take a Test</button>
    <button class="qa-btn btn-o" onclick="startFlash()">üÉè Flashcards</button>
  </div>
  <div class="wod"><div class="stitle">üåü Word of the Day</div><div id="wod" class="w-card" style="cursor:default"></div></div>
</div>

<div id="s-learn" class="section">
  <div class="stitle">üìö Vocabulary Library</div>
  <div class="mbar" id="learnModes">
    <button class="m-btn active" onclick="setLM('grid')">üìã Grid</button>
    <button class="m-btn" onclick="setLM('flash')">üÉè Flashcards</button>
    <button class="m-btn" onclick="setLM('list')">üìù List</button>
  </div>
  <div class="fbar">
    <input class="search-in" id="lSearch" placeholder="Filter words..." style="max-width:280px;padding-left:14px" oninput="renderLearn()">
    <select class="f-sel" id="lLetter" onchange="renderLearn()"><option value="">All Letters</option></select>
    <button class="f-tag active" onclick="setLF('all',this)">All</button>
    <button class="f-tag" onclick="setLF('new',this)">New</button>
    <button class="f-tag" onclick="setLF('learned',this)">Learned</button>
    <button class="f-tag" onclick="setLF('fav',this)">‚òÖ Fav</button>
  </div>
  <div class="abar" id="abar"></div>
  <div id="lGrid" class="w-grid"></div>
  <div id="lFlash" class="fc-wrap" style="display:none"></div>
  <div id="lList" style="display:none"></div>
  <div class="pag" id="lPag"></div>
</div>

<div id="s-test" class="section">
  <div id="tHome"><div class="stitle">‚úçÔ∏è SAT Vocabulary Tests ‚Äî 38 Units</div>
    <p style="color:var(--td);margin-bottom:16px">Each unit has 12 fill-in-the-blank questions.</p>
    <div class="tu-grid" id="tuGrid"></div></div>
  <div id="tActive" style="display:none"></div>
  <div id="tResults" style="display:none"></div>
</div>

<div id="s-fav" class="section">
  <div class="stitle">‚ù§Ô∏è My Favorites</div>
  <div class="mbar" id="favModes">
    <button class="m-btn active" onclick="setFM('grid')">üìã Grid</button>
    <button class="m-btn" onclick="setFM('flash')">üÉè Flashcards</button>
    <button class="m-btn" onclick="exportFav()">üì• Export CSV</button>
    <button class="m-btn" onclick="clearFav()">üóëÔ∏è Clear All</button>
  </div>
  <div id="fGrid" class="w-grid"></div>
  <div id="fFlash" class="fc-wrap" style="display:none"></div>
  <div id="fEmpty" class="fav-empty" style="display:none"><div class="fav-empty-ic">üíî</div><h3>No favorites yet</h3><p>Click the ‚ù§Ô∏è on any word to save it here!</p></div>
</div>

</div>

<div class="modal-ov" id="modal" onclick="if(event.target===this)closeM()">
  <div class="modal" id="modalC"></div>
</div>
<div class="toast" id="toast"></div>

<footer class="site-footer">
  <div class="visitor-counter">
    <span class="vc-icon">üë•</span>
    <span class="vc-label">Visitors:</span>
    <span class="vc-num" id="visitorCount">--</span>
  </div>
  <div style="margin-top:8px"><button onclick="if(confirm('Clear all cached AI images?')){localStorage.removeItem('sat_img_cache');toast('Image cache cleared!')}" style="background:none;color:var(--td);font-size:.75em;text-decoration:underline;padding:2px 6px">üóëÔ∏è Clear Image Cache</button></div>
  <div style="margin-top:6px">¬© 2026 SAT Vocab Master | fun2learnsatvocabtw.com</div>
</footer>

<script>
// ===== STATE =====
let V=[],T=[],A={},MUSIC={},VISUAL={};
let favs=new Set(JSON.parse(localStorage.getItem('sf')||'[]'));
let lrn=new Set(JSON.parse(localStorage.getItem('sl')||'[]'));
let scores=JSON.parse(localStorage.getItem('ss')||'{}');
let sec='home',lm='grid',lp=1,lf='all';
const PP=24;
let tUnit=null,tQ=0,tAns={},tDone=false;
let fi=0,fw=[];

// ===== LOAD =====
async function loadData(){
  try{
    const [vr,tr,ar,mr,vsr]=await Promise.all([
      fetch('vocab_data.json'),fetch('test_data.json'),fetch('answers.json'),
      fetch('music_data.json').catch(()=>null),
      fetch('visual_data.json').catch(()=>null)
    ]);
    V=await vr.json();T=await tr.json();A=await ar.json();
    if(mr&&mr.ok)MUSIC=await mr.json();
    if(vsr&&vsr.ok)VISUAL=await vsr.json();
  }catch(e){console.error(e)}
  init();
}

function init(){
  document.getElementById('stTotal').textContent=V.length;
  updStats();renderWOD();initAlpha();
}

// ===== NAV =====
function go(s){
  sec=s;
  document.querySelectorAll('.section').forEach(e=>e.classList.remove('active'));
  document.getElementById('s-'+s).classList.add('active');
  document.querySelectorAll('.nav-tab').forEach(t=>{t.classList.remove('active');if((s==='fav'&&t.textContent==='Favorites')||(s!=='fav'&&t.textContent.toLowerCase().includes(s)))t.classList.add('active')});
  document.querySelectorAll('.mob-btn').forEach(t=>{t.classList.remove('active');if(t.dataset.s===s)t.classList.add('active')});
  if(s==='learn')renderLearn();if(s==='test')renderTHome();if(s==='fav')renderFav();
  window.scrollTo(0,0);
}

// ===== SEARCH =====
function doSearch(q){
  const r=document.getElementById('sResults');
  if(!q||q.length<1){r.classList.remove('show');return}
  const ql=q.toLowerCase();
  const m=V.filter(w=>w.word.toLowerCase().startsWith(ql)||w.word.toLowerCase().includes(ql)||w.engDef.toLowerCase().includes(ql)).slice(0,12);
  if(!m.length){r.innerHTML='<div class="sr-item"><div class="sr-w">No results</div></div>'}
  else{r.innerHTML=m.map(w=>`<div class="sr-item" onclick="showW(${w.id})"><div class="sr-w">${emoji(w)} ${w.word} <span style="color:var(--td);font-weight:400;font-size:.82em">${w.pronunciation}</span></div><div class="sr-d">${w.engDef.substring(0,90)}${w.engDef.length>90?'...':''}</div></div>`).join('')}
  r.classList.add('show');
}
document.addEventListener('click',e=>{if(!e.target.closest('.search-c'))document.getElementById('sResults').classList.remove('show')});

// ===== EMOJI & VISUAL ‚Äî from visual_data.json =====
function emoji(w){
  const wl=w.word.toLowerCase();
  if(VISUAL[wl]&&VISUAL[wl].emoji_scene)return VISUAL[wl].emoji_scene;
  return 'üìù';
}
function getVisual(w){
  const wl=w.word.toLowerCase();
  return VISUAL[wl]||null;
}
function visualHTML(w){
  const v=getVisual(w);
  if(!v||!v.visual)return '';
  const wl=w.word.toLowerCase();
  const cached=getImgCache(wl);
  const imgContent=cached
    ?`<div class="w-img-wrap"><img src="${cached}" alt="${w.word}"></div>`
    :`<div class="w-img-wrap" id="imgWrap_${w.id}">
        <button class="gen-img-btn" onclick="genImg('${wl.replace(/'/g,"\\'")}',${w.id},event)">üé® Generate AI Image</button>
      </div>`;
  return `<div class="w-visual">
    üñºÔ∏è <em>${v.visual}</em>
    ${imgContent}
  </div>`;
}

// ===== AI IMAGE GENERATION (Pollinations.ai - FREE unlimited) =====
const IMG_CACHE_KEY='sat_img_cache';
function getImgCache(word){
  try{const c=JSON.parse(localStorage.getItem(IMG_CACHE_KEY)||'{}');return c[word]||null}catch(e){return null}
}
function setImgCache(word,url){
  try{
    const c=JSON.parse(localStorage.getItem(IMG_CACHE_KEY)||'{}');
    c[word]=url;
    // Keep cache under 3MB by removing oldest entries if needed
    const str=JSON.stringify(c);
    if(str.length>3000000){const keys=Object.keys(c);for(let i=0;i<10&&keys.length>0;i++)delete c[keys.shift()]}
    localStorage.setItem(IMG_CACHE_KEY,JSON.stringify(c));
  }catch(e){console.warn('Cache full',e)}
}
function genImg(word,id,ev){
  if(ev){ev.stopPropagation();ev.preventDefault()}
  const v=VISUAL[word];
  if(!v)return;
  const wrap=document.getElementById('imgWrap_'+id);
  if(!wrap)return;
  wrap.innerHTML=`<div class="img-loading"><div class="spinner"></div>Generating image for "${word}"...</div>`;
  const prompt=encodeURIComponent(`Simple clear educational illustration: ${v.visual}. Colorful, no text`);
  const imgUrl=`https://image.pollinations.ai/prompt/${prompt}`;
  const img=new Image();
  img.crossOrigin='anonymous';
  img.onload=()=>{
    setImgCache(word,imgUrl);
    wrap.innerHTML=`<img src="${imgUrl}" alt="${word}" style="width:100%;border-radius:var(--rs);display:block">`;
  };
  img.onerror=()=>{
    wrap.innerHTML=`<div class="img-loading" style="color:var(--d)">‚ö†Ô∏è Image generation failed. Try again later.</div>
    <button class="gen-img-btn" onclick="genImg('${word}',${id},event)" style="margin:8px auto;display:flex">üîÑ Retry</button>`;
  };
  img.src=imgUrl;
}

// ===== SAMPLE SENTENCE ‚Äî from visual_data.json =====
function sentence(w){
  const wl=w.word.toLowerCase();
  const wrd=w.word;
  if(VISUAL[wl]&&VISUAL[wl].sentence){
    // Bold the word in the sentence
    const s=VISUAL[wl].sentence;
    const rx=new RegExp('\\b'+wrd.replace(/[.*+?^\${}()|[\]\\]/g,'\\$&')+'\\b','gi');
    return s.replace(rx,'<strong>$&</strong>');
  }
  return `The concept of <strong>${wrd}</strong> is important in academic contexts.`;
}

// ===== PRONUNCIATION ‚Äî use ResponsiveVoice or Web Speech API with correct settings =====
function speak(word,ev){
  if(ev){ev.stopPropagation();ev.preventDefault()}
  if(!('speechSynthesis' in window))return;
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(word);
  u.lang='en-US';
  u.rate=0.75; // Slower for clarity
  u.pitch=1.0;
  u.volume=1.0;
  // Prefer high-quality voices
  const vs=speechSynthesis.getVoices();
  const pref=['Google US English','Samantha','Alex','Daniel','Karen','Moira','Tessa'];
  let voice=null;
  for(const name of pref){voice=vs.find(v=>v.name.includes(name));if(voice)break}
  if(!voice)voice=vs.find(v=>v.lang==='en-US'&&!v.localService)||vs.find(v=>v.lang==='en-US')||vs.find(v=>v.lang.startsWith('en'));
  if(voice)u.voice=voice;
  speechSynthesis.speak(u);
}
// Pre-load voices
if('speechSynthesis' in window){
  speechSynthesis.getVoices();
  speechSynthesis.onvoiceschanged=()=>speechSynthesis.getVoices();
}

// ===== MUSIC CONNECTION =====
function getMusic(w){
  const wl=w.word.toLowerCase();
  if(MUSIC[wl])return MUSIC[wl];
  return null;
}

function musicHTML(w){
  const m=getMusic(w);
  if(!m)return '';
  const searchQ=encodeURIComponent(m.song+' '+m.artist);
  return `<div class="w-music">
    üéµ <a href="https://www.youtube.com/results?search_query=${searchQ}" target="_blank">"${m.song}"</a> by ${m.artist}
    <div style="color:var(--td);font-size:.9em;margin-top:3px">${m.connection}</div>
  </div>`;
}

// ===== FAVORITES =====
function togFav(id,ev){
  if(ev){ev.stopPropagation();ev.preventDefault()}
  if(favs.has(id)){favs.delete(id);toast('Removed from favorites')}
  else{favs.add(id);toast('Added to favorites ‚ù§Ô∏è')}
  localStorage.setItem('sf',JSON.stringify([...favs]));
  updStats();
  if(sec==='learn')renderLearn();if(sec==='fav')renderFav();
}
function markL(id){lrn.add(id);localStorage.setItem('sl',JSON.stringify([...lrn]));updStats()}
function updStats(){
  document.getElementById('nLearned').textContent=lrn.size;
  document.getElementById('nFav').textContent=favs.size;
  document.getElementById('stMast').textContent=lrn.size;
}

// ===== WORD DETAIL MODAL =====
function showW(id){
  const w=V.find(x=>x.id===id);if(!w)return;
  markL(id);
  document.getElementById('sResults').classList.remove('show');
  const em=emoji(w),sn=sentence(w),isFav=favs.has(w.id),mus=musicHTML(w),vis=visualHTML(w);
  document.getElementById('modalC').innerHTML=`
    <button class="modal-x" onclick="closeM()">‚úï</button>
    <div style="text-align:center;margin-bottom:18px">
      <div style="font-size:3em;margin-bottom:5px">${em}</div>
      <div style="font-size:2em;font-weight:800;background:var(--g1);-webkit-background-clip:text;-webkit-text-fill-color:transparent">${w.word}</div>
      <div style="color:var(--td);margin-top:4px;font-size:.95em">${w.pronunciation}</div>
      <div style="margin-top:10px;display:flex;gap:8px;justify-content:center">
        <button class="w-btn ${isFav?'fav':''}" onclick="togFav(${w.id},event);showW(${w.id})" style="width:38px;height:38px;font-size:1em">${isFav?'‚ù§Ô∏è':'ü§ç'}</button>
        <button class="w-btn" onclick="speak('${w.word.replace(/'/g,"\\'")}',event)" style="width:38px;height:38px;font-size:1em">üîä</button>
      </div>
    </div>
    <div style="margin-bottom:14px"><div style="font-weight:600;color:var(--pl);margin-bottom:5px">üìñ Definition</div><div class="w-def">${w.engDef}</div></div>
    ${vis?`<div style="margin-bottom:14px"><div style="font-weight:600;color:var(--pl);margin-bottom:5px">üñºÔ∏è Picture This</div>${vis}</div>`:''}
    <div style="margin-bottom:14px"><div style="font-weight:600;color:var(--a2);margin-bottom:5px">üí¨ Example Sentence</div><div class="w-sent">${sn}</div></div>
    ${mus?`<div style="margin-bottom:14px"><div style="font-weight:600;color:var(--music);margin-bottom:5px">üéµ Music Connection</div>${mus}</div>`:''}
    ${w.extra?`<div><div style="font-weight:600;color:var(--td);margin-bottom:5px">üìù Word Roots & Related</div><div class="w-extra" style="border:0;padding:0">${w.extra}</div></div>`:''}
  `;
  document.getElementById('modal').classList.add('show');
}
function closeM(){document.getElementById('modal').classList.remove('show')}
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeM()});

// ===== LEARN =====
function getFiltered(){
  let ws=[...V];
  const q=(document.getElementById('lSearch')?.value||'').toLowerCase();
  if(q)ws=ws.filter(w=>w.word.toLowerCase().includes(q)||w.engDef.toLowerCase().includes(q));
  const lt=document.getElementById('lLetter')?.value||'';
  if(lt)ws=ws.filter(w=>w.word.toLowerCase().startsWith(lt));
  if(lf==='new')ws=ws.filter(w=>!lrn.has(w.id));
  if(lf==='learned')ws=ws.filter(w=>lrn.has(w.id));
  if(lf==='fav')ws=ws.filter(w=>favs.has(w.id));
  return ws;
}

function renderLearn(){
  const ws=getFiltered(),tp=Math.ceil(ws.length/PP);
  if(lp>tp)lp=1;
  const start=(lp-1)*PP,pg=ws.slice(start,start+PP);
  if(lm==='grid'){
    show('lGrid');hide('lFlash');hide('lList');
    document.getElementById('lGrid').innerHTML=pg.map(w=>wCard(w)).join('');
  }else if(lm==='flash'){
    hide('lGrid');show('lFlash');hide('lList');fw=ws;fi=start;renderFC('lFlash');
  }else{
    hide('lGrid');hide('lFlash');show('lList');
    document.getElementById('lList').innerHTML=`<div style="overflow-x:auto"><table style="width:100%;border-collapse:collapse">
      <thead><tr style="border-bottom:2px solid var(--b)">
        <th style="padding:8px;text-align:left;color:var(--td)">Word</th>
        <th style="padding:8px;text-align:left;color:var(--td)">Pronunciation</th>
        <th style="padding:8px;text-align:left;color:var(--td)">Definition</th>
        <th style="padding:8px;text-align:center;color:var(--td)">Actions</th>
      </tr></thead><tbody>
      ${pg.map(w=>`<tr style="border-bottom:1px solid var(--b);cursor:pointer" onclick="showW(${w.id})">
        <td style="padding:8px;font-weight:700">${emoji(w)} ${w.word}</td>
        <td style="padding:8px;color:var(--td);font-size:.85em">${w.pronunciation}</td>
        <td style="padding:8px;font-size:.85em">${w.engDef.substring(0,70)}...</td>
        <td style="padding:8px;text-align:center;white-space:nowrap">
          <button class="w-btn ${favs.has(w.id)?'fav':''}" onclick="togFav(${w.id},event)">${favs.has(w.id)?'‚ù§Ô∏è':'ü§ç'}</button>
          <button class="w-btn" onclick="speak('${w.word.replace(/'/g,"\\'")}',event)">üîä</button>
        </td>
      </tr>`).join('')}</tbody></table></div>`;
  }
  renderPag(tp,'lPag',p=>{lp=p;renderLearn()});
}

function wCard(w){
  const em=emoji(w),isFav=favs.has(w.id),isL=lrn.has(w.id),mus=getMusic(w),vis=getVisual(w);
  const wl=w.word.toLowerCase();
  const cachedImg=getImgCache(wl);
  return `<div class="w-card fin" onclick="showW(${w.id})">
    ${isL?'<div class="w-tag">‚úì Learned</div>':''}
    <div class="w-head"><div><div class="w-title">${w.word}</div><div class="w-pron">${w.pronunciation}</div></div>
    <div class="w-acts"><button class="w-btn ${isFav?'fav':''}" onclick="togFav(${w.id},event)">${isFav?'‚ù§Ô∏è':'ü§ç'}</button><button class="w-btn" onclick="speak('${w.word.replace(/'/g,"\\'")}',event)">üîä</button></div></div>
    ${cachedImg?`<div class="w-img-wrap" style="margin:6px 0;max-height:140px"><img src="${cachedImg}" alt="${w.word}" style="max-height:140px"></div>`
      :`<div class="w-emoji">${em}</div>`}
    <div class="w-def">${w.engDef.substring(0,110)}${w.engDef.length>110?'...':''}</div>
    ${!cachedImg&&vis?`<div class="w-visual" style="margin-top:6px">üñºÔ∏è <em>${vis.visual.substring(0,80)}${vis.visual.length>80?'...':''}</em></div>`:''}
    ${mus?`<div class="w-music" style="margin-top:6px">üéµ "${mus.song}" ‚Äî ${mus.artist}</div>`:''}
  </div>`;
}

function renderFC(target){
  if(!fw.length)return;
  if(fi>=fw.length)fi=0;if(fi<0)fi=fw.length-1;
  const w=fw[fi],em=emoji(w),sn=sentence(w),mus=musicHTML(w),vis=visualHTML(w);
  markL(w.id);
  document.getElementById(target).innerHTML=`
    <div style="text-align:center;margin-bottom:12px;color:var(--td)">Card ${fi+1} of ${fw.length}</div>
    <div class="fc" id="fc" onclick="this.classList.toggle('flip')">
      <div class="fc-face">
        <div style="font-size:2.5em;margin-bottom:8px">${em}</div>
        <div style="font-size:2.2em;font-weight:800;background:var(--g1);-webkit-background-clip:text;-webkit-text-fill-color:transparent">${w.word}</div>
        <div style="color:var(--td);margin-top:6px">${w.pronunciation}</div>
        <div style="color:var(--td);margin-top:12px;font-size:.85em">Tap to flip ‚Üí</div>
      </div>
      <div class="fc-face fc-back" style="text-align:left;justify-content:flex-start;padding-top:22px;overflow-y:auto">
        <div style="text-align:center;margin-bottom:12px"><span style="font-size:1.8em">${em}</span>
        <div style="font-size:1.2em;font-weight:700;color:var(--pl)">${w.word}</div></div>
        <div style="margin-bottom:8px"><b style="color:var(--pl)">üìñ</b> ${w.engDef}</div>
        ${vis?`<div style="margin-bottom:8px">${vis}</div>`:''}
        <div class="w-sent" style="margin-bottom:8px">üí¨ ${sn}</div>
        ${mus||''}
      </div>
    </div>
    <div class="fc-nav">
      <button class="t-btn btn-o" onclick="fi--;renderFC('${target}')">‚Üê Prev</button>
      <button class="w-btn ${favs.has(w.id)?'fav':''}" onclick="togFav(${w.id});renderFC('${target}')" style="width:40px;height:40px;font-size:1em">${favs.has(w.id)?'‚ù§Ô∏è':'ü§ç'}</button>
      <button class="w-btn" onclick="speak('${w.word.replace(/'/g,"\\'")}')">üîä</button>
      <button class="t-btn btn-p" onclick="fi++;renderFC('${target}')">Next ‚Üí</button>
    </div>`;
}

function startFlash(){go('learn');setLM('flash');fw=V;fi=Math.floor(Math.random()*V.length);renderFC('lFlash')}
function setLM(m){
  lm=m;
  document.querySelectorAll('#learnModes .m-btn').forEach(b=>{b.classList.remove('active');
    if((m==='grid'&&b.textContent.includes('Grid'))||(m==='flash'&&b.textContent.includes('Flash'))||(m==='list'&&b.textContent.includes('List')))b.classList.add('active')});
  renderLearn();
}
function setLF(f,btn){
  lf=f;lp=1;
  document.querySelectorAll('.fbar .f-tag').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');renderLearn();
}

function renderPag(tp,cid,cb){
  const c=document.getElementById(cid);if(tp<=1){c.innerHTML='';return}
  let h=`<button class="pg-btn" ${lp===1?'disabled':''} data-p="${lp-1}">‚Üê Prev</button>`;
  const ps=[1];if(lp>3)ps.push('...');
  for(let i=Math.max(2,lp-1);i<=Math.min(tp-1,lp+1);i++)ps.push(i);
  if(lp<tp-2)ps.push('...');if(tp>1)ps.push(tp);
  ps.forEach(p=>{if(p==='...')h+=`<span style="color:var(--td);padding:6px 3px">...</span>`;
    else h+=`<button class="pg-btn ${p===lp?'active':''}" data-p="${p}">${p}</button>`});
  h+=`<button class="pg-btn" ${lp===tp?'disabled':''} data-p="${lp+1}">Next ‚Üí</button>`;
  c.innerHTML=h;
  c.querySelectorAll('.pg-btn[data-p]').forEach(b=>b.addEventListener('click',()=>{const p=parseInt(b.dataset.p);if(p>=1&&p<=tp)cb(p)}));
}

function initAlpha(){
  const letters='ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
  document.getElementById('abar').innerHTML=letters.map(l=>`<button class="a-btn" onclick="toggleAlpha('${l}',this)">${l}</button>`).join('');
  const sel=document.getElementById('lLetter');
  letters.forEach(l=>{const cnt=V.filter(w=>w.word.toUpperCase().startsWith(l)).length;
    if(cnt>0){const o=document.createElement('option');o.value=l.toLowerCase();o.textContent=`${l} (${cnt})`;sel.appendChild(o)}});
}
function toggleAlpha(l,btn){
  const sel=document.getElementById('lLetter');
  if(sel.value===l.toLowerCase()){sel.value='';btn.classList.remove('active')}
  else{sel.value=l.toLowerCase();document.querySelectorAll('.a-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active')}
  lp=1;renderLearn();
}

// ===== TEST =====
function renderTHome(){
  show('tHome');hide('tActive');hide('tResults');
  document.getElementById('tuGrid').innerHTML=T.map(u=>{
    const sc=scores[u.unit],
      txt=sc!==undefined?`${sc}/12 (${Math.round(sc/12*100)}%)`:'Not taken',
      col=sc!==undefined?(sc>=10?'var(--s)':sc>=7?'var(--a2)':'var(--d)'):'var(--td)';
    return `<div class="tu-card" onclick="startT(${u.unit})"><div class="tu-num">Unit ${u.unit}</div><div class="tu-label">12 Questions</div><div class="tu-score" style="color:${col}">${txt}</div></div>`;
  }).join('');
}
function startT(n){
  tUnit=T.find(u=>u.unit===n);if(!tUnit)return;
  tQ=0;tAns={};tDone=false;hide('tHome');show('tActive');hide('tResults');renderQ();
}
function renderQ(){
  if(!tUnit)return;
  const total=tUnit.questions.length,q=tUnit.questions[tQ],prog=(tQ+1)/total*100,sel=tAns[q.number],cor=A[String(q.number)];
  let optsH=q.options.map(o=>{
    let cls='opt-btn';
    if(tDone){if(o.letter===cor)cls+=' cor';else if(o.letter===sel&&o.letter!==cor)cls+=' wrn'}
    else if(o.letter===sel)cls+=' sel';
    return `<button class="${cls}" onclick="${tDone?'':`selA(${q.number},'${o.letter}')`}"><span class="opt-l">${o.letter}</span><span>${o.text}</span></button>`;
  }).join('');
  document.getElementById('tActive').innerHTML=`<div class="t-wrap">
    <div class="t-head"><h2 style="font-size:1.2em">Unit ${tUnit.unit}</h2><button class="t-btn btn-o" onclick="renderTHome()">‚úï Exit</button></div>
    <div class="t-prog"><div class="t-prog-bar" style="width:${prog}%"></div></div>
    <div class="q-card fin">
      <div class="q-num">Question ${tQ+1} of ${total}</div>
      <div class="q-text">${q.text.replace(/_{2,}/g,'<span class="q-blank">&nbsp;</span>')}</div>
      <div class="opts">${optsH}</div>
    </div>
    <div class="t-nav">
      <button class="t-btn btn-o" onclick="tQ>0&&(tQ--,renderQ())" ${tQ===0?'disabled style="opacity:.4"':''}>‚Üê Prev</button>
      ${tQ<total-1?`<button class="t-btn btn-p" onclick="tQ++;renderQ()">Next ‚Üí</button>`
        :`<button class="t-btn btn-s" onclick="submitT()">üìù Submit</button>`}
    </div>
    <div class="q-dots">${tUnit.questions.map((qq,i)=>{
      const ans=tAns[qq.number]!==undefined,cur=i===tQ;
      let bg='var(--bg3)';
      if(tDone){const ok=tAns[qq.number]===A[String(qq.number)];bg=ans?(ok?'var(--s)':'var(--d)'):'var(--bg3)'}
      else if(cur)bg='var(--p)';else if(ans)bg='var(--pl)';
      return `<button class="q-dot" style="background:${bg};border:${cur?'2px solid #fff':'none'}" onclick="tQ=${i};renderQ()">${i+1}</button>`;
    }).join('')}</div></div>`;
}
function selA(qn,l){if(tDone)return;tAns[qn]=l;renderQ()}
function submitT(){
  tDone=true;let cor=0;const total=tUnit.questions.length;
  tUnit.questions.forEach(q=>{if(tAns[q.number]===A[String(q.number)])cor++});
  scores[tUnit.unit]=cor;localStorage.setItem('ss',JSON.stringify(scores));
  const pct=Math.round(cor/total*100);
  let g='üèÜ',gt='Perfect Score!';
  if(pct<100){g='üåü';gt='Excellent!'}if(pct<85){g='üëç';gt='Good Job!'}
  if(pct<70){g='üìö';gt='Keep Studying!'}if(pct<50){g='üí™';gt='More Practice Needed'}
  hide('tActive');show('tResults');
  document.getElementById('tResults').innerHTML=`<div class="t-wrap"><div class="res-card fin">
    <div style="font-size:3.5em;margin-bottom:8px">${g}</div><div class="res-score">${pct}%</div><div class="res-label">${gt}</div>
    <div class="res-row">
      <div class="res-item"><div class="n" style="color:var(--s)">${cor}</div><div class="l">Correct</div></div>
      <div class="res-item"><div class="n" style="color:var(--d)">${total-cor}</div><div class="l">Wrong</div></div>
      <div class="res-item"><div class="n" style="color:var(--pl)">${total}</div><div class="l">Total</div></div>
    </div>
    <div style="margin-top:16px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
      <button class="t-btn btn-p" onclick="tQ=0;tDone=true;hide('tResults');show('tActive');renderQ()">üìã Review</button>
      <button class="t-btn btn-s" onclick="startT(${tUnit.unit})">üîÑ Retake</button>
      <button class="t-btn btn-o" onclick="renderTHome()">‚Üê Units</button>
    </div></div></div>`;
}

// ===== FAVORITES =====
function renderFav(){
  const ws=V.filter(w=>favs.has(w.id));
  if(!ws.length){hide('fGrid');hide('fFlash');show('fEmpty');return}
  show('fGrid');hide('fFlash');hide('fEmpty');
  document.getElementById('fGrid').innerHTML=ws.map(w=>wCard(w)).join('');
}
function setFM(m){
  const ws=V.filter(w=>favs.has(w.id));
  document.querySelectorAll('#favModes .m-btn').forEach(b=>b.classList.remove('active'));
  if(m==='grid'){show('fGrid');hide('fFlash');hide('fEmpty');renderFav();document.querySelectorAll('#favModes .m-btn')[0].classList.add('active')}
  else if(m==='flash'){
    if(!ws.length){toast('No favorites yet');return}
    hide('fGrid');show('fFlash');hide('fEmpty');fw=ws;fi=0;renderFC('fFlash');document.querySelectorAll('#favModes .m-btn')[1].classList.add('active')}
}
function exportFav(){
  const ws=V.filter(w=>favs.has(w.id));if(!ws.length){toast('No favorites');return}
  let csv='Word,Pronunciation,Definition\n';
  ws.forEach(w=>{csv+=`"${w.word}","${w.pronunciation}","${w.engDef.replace(/"/g,'""')}"\n`});
  const blob=new Blob(['\ufeff'+csv],{type:'text/csv;charset=utf-8;'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='sat_favorites.csv';a.click();toast('Exported!');
}
function clearFav(){if(!confirm('Clear all favorites?'))return;favs.clear();localStorage.setItem('sf','[]');updStats();renderFav();toast('Cleared')}

// ===== WOD =====
function renderWOD(){
  const d=new Date(),idx=(d.getFullYear()*366+d.getMonth()*31+d.getDate())%V.length,w=V[idx];
  if(!w)return;
  const em=emoji(w),mus=getMusic(w);
  document.getElementById('wod').innerHTML=`
    <div class="w-head"><div><div class="w-title" style="font-size:1.4em">${w.word}</div><div class="w-pron">${w.pronunciation}</div></div>
    <div class="w-acts"><button class="w-btn ${favs.has(w.id)?'fav':''}" onclick="togFav(${w.id},event)">${favs.has(w.id)?'‚ù§Ô∏è':'ü§ç'}</button><button class="w-btn" onclick="speak('${w.word.replace(/'/g,"\\'")}',event)">üîä</button></div></div>
    <div class="w-emoji">${em}</div>
    <div class="w-def">${w.engDef}</div>
    ${mus?`<div class="w-music" style="margin-top:8px">üéµ "${mus.song}" ‚Äî ${mus.artist}<div style="color:var(--td);font-size:.9em;margin-top:2px">${mus.connection}</div></div>`:''}`;
  document.getElementById('wod').onclick=()=>showW(w.id);
}

// ===== UTIL =====
function show(id){document.getElementById(id).style.display=''}
function hide(id){document.getElementById(id).style.display='none'}
function toast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2000)}

// ===== VISITOR COUNTER =====
(function(){
  const vc=document.getElementById('visitorCount');
  // Use hits.seeyoufarm.com free counter API (reliable, no registration)
  fetch('https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Ffun2learnsatvocabtw.com&count_bg=%2300B894&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=visits&edge_flat=true')
    .then(r=>r.text())
    .then(svg=>{
      // Extract total count from SVG text
      const m=svg.match(/(\d+)\s*\/\s*(\d+)/);
      if(m&&vc){
        vc.textContent=m[2];// total hits
        vc.title='Today: '+m[1]+' | Total: '+m[2];
      }
    })
    .catch(()=>{});
  // Fallback display with local counter
  const VC_KEY='sat_vc';
  let c=parseInt(localStorage.getItem(VC_KEY)||'0');
  const lastVisit=localStorage.getItem(VC_KEY+'_t');
  const now=Date.now();
  if(!lastVisit||now-parseInt(lastVisit)>300000){c++;localStorage.setItem(VC_KEY,c);localStorage.setItem(VC_KEY+'_t',now)}
  if(vc&&vc.textContent==='--')vc.textContent=c>0?c.toLocaleString():'1';
})();

loadData();
</script>
</body>
</html>
